<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenleaf National Bank - Forgot Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0V4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg-primary: #0A2E20; /* Darker Forest Green */
            --bg-secondary: #1A4D35; /* Medium Forest Green */
            --bg-card: #2B684B; /* Slightly Lighter Green for cards */
            --text-primary: #E6F0E6; /* Off-white / Light Greenish Gray */
            --text-secondary: #A0C0A0; /* Muted Greenish Gray */
            --border-color: #4CAF50; /* Vibrant Green Accent */
            --shadow-color: rgba(0, 0, 0, 0.4);
            --btn-green-from: #4CAF50; /* Green 500 */
            --btn-green-to: #388E3C; /* Green 700 */
            --btn-red: #dc2626; /* Red 600 */
            --btn-red-hover: #b91c1c; /* Red 700 */
            --icon-cyan: #81C784; /* Light Green for general icons */
        }

        /* Light Theme */
        body.theme-light {
            --bg-primary: #e6f0e6;
            --bg-secondary: #c8e6c9;
            --bg-card: #ffffff;
            --text-primary: #0A2E20;
            --text-secondary: #1A4D35;
            --border-color: #81C784;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --btn-green-from: #4CAF50;
            --btn-green-to: #388E3C;
            --btn-red: #ef4444;
            --btn-red-hover: #dc2626;
            --icon-cyan: #4CAF50;
        }

        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.5s ease, color 0.5s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        h1, h2, h3 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }

        /* Preloader styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.7s ease-out, visibility 0.7s ease-out;
            opacity: 1;
            visibility: visible;
        }

        .preloader-hidden {
            opacity: 0;
            visibility: hidden;
        }

        #finflow-text {
            animation: text-pop-in 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards, text-glow 2s infinite alternate;
            transform: scale(0.8);
            opacity: 0;
            display: block;
            color: var(--text-primary);
        }

        @keyframes text-pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes text-glow {
            0% { text-shadow: 0 0 5px rgba(76, 175, 80, 0.5), 0 0 10px rgba(129, 199, 132, 0.3); }
            100% { text-shadow: 0 0 15px rgba(76, 175, 80, 0.8), 0 0 25px rgba(129, 199, 132, 0.5); }
        }

        @keyframes ping-slow {
            0% { transform: scale(0.8); opacity: 0.75; }
            100% { transform: scale(1.2); opacity: 0; }
        }

        .animate-ping-slow {
            animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        .animate-ping-slow-delay {
            animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite 1s;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .animate-spin-fast {
            animation: spin 1s linear infinite;
        }

        #loading-bar {
            animation: loading-bar-pulse 1.5s infinite alternate;
        }

        @keyframes loading-bar-pulse {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .btn-glow {
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }
        .btn-glow:hover {
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.7);
        }

        .form-card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--border-color));
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px var(--shadow-color);
            transform: translateY(20px);
            opacity: 0;
            animation: fade-in-up-content 1s ease-out forwards;
        }

        @keyframes fade-in-up-content {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Specific styles for input fields to ensure dark text on light background */
        input[type="email"] {
            background-color: #f8f8f8; /* A very light gray */
            color: #333; /* Dark gray text */
            border: 1px solid #ccc; /* Neutral border */
            transition: all 0.3s ease; /* Smooth transition for focus */
        }

        input[type="email"]:focus {
            border-color: var(--icon-cyan); /* Use a theme color for focus highlight */
            box-shadow: 0 0 0 2px rgba(129, 199, 132, 0.5); /* Soft glow */
        }

        /* Adjust placeholder color */
        input::placeholder {
            color: #888;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-primary-green text-primary-light">

    <!-- Preloader -->
    <div id="preloader">
        <div class="flex flex-col items-center">
            <div class="text-4xl sm:text-5xl md:text-7xl font-extrabold text-white mb-6 relative overflow-hidden">
                <span id="finflow-text" class="block">Greenleaf National Bank</span>
            </div>
            <div class="relative w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center mb-8">
                <div class="absolute w-full h-full rounded-full border-4 border-border-color animate-ping-slow opacity-75"></div>
                <div class="absolute w-full h-full rounded-full border-4 border-icon-cyan animate-ping-slow-delay opacity-75"></div>
                <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-btn-green-from to-btn-green-to flex items-center justify-center text-lg sm:text-xl font-bold">
                    <i class="fas fa-sync-alt animate-spin-fast"></i>
                </div>
            </div>
            <div class="w-48 sm:w-64 h-3 bg-secondary-green rounded-full overflow-hidden shadow-inner">
                <div id="loading-bar" class="h-full bg-gradient-to-r from-icon-cyan to-btn-green-to w-0 rounded-full transition-all duration-1000 ease-in-out"></div>
            </div>
            <p class="text-sm sm:text-lg text-secondary-light mt-4">Loading...</p>
        </div>
    </div>

    <!-- Forgot Password Form -->
    <div id="forgot-password-card" class="form-card p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md mx-auto">
        <h2 class="text-2xl sm:text-3xl font-extrabold text-primary-light mb-6 flex items-center justify-center">
            <i class="fas fa-lock-open text-icon-cyan mr-3"></i> Forgot Password
        </h2>
        <p class="text-secondary-light text-sm sm:text-base mb-6 text-center">
            Enter your email address below and we'll send you a link to reset your password.
        </p>
        <form id="forgot-password-form" class="space-y-4 sm:space-y-6">
            <div>
                <label for="email" class="block text-secondary-light text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-left">Email Address</label>
                <input type="email" id="email" required class="w-full px-3 py-2 sm:px-4 sm:py-3 rounded-lg placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-icon-cyan" placeholder="your.email@example.com">
            </div>
            <p id="message" class="text-sm sm:text-base text-center hidden"></p>
            <button type="submit" id="reset-password-btn" class="w-full flex items-center justify-center px-4 py-2.5 sm:px-6 sm:py-3 bg-gradient-to-r from-btn-green-from to-btn-green-to text-primary-light rounded-full text-sm sm:text-base font-semibold shadow-lg hover:from-btn-green-to hover:to-btn-green-from transition duration-300 btn-glow">
                Send Reset Link
                <span id="loading-spinner" class="loading-spinner ml-2 hidden"></span>
            </button>
            <p class="text-center text-secondary-light text-sm sm:text-base mt-4">
                Remember your password? <a href="login.html" class="text-icon-cyan hover:underline font-medium">Back to Login</a>
            </p>
        </form>
    </div>

    <script type="module">
        // Firebase configuration (use the same as your other Firebase files)
        const firebaseConfig = {
            apiKey: "AIzaSyCAAH3xgk4pdBWmqp-Dsjhk48KMycRaU18",
            authDomain: "paralegal-web-app.firebaseapp.com",
            databaseURL: "https://paralegal-web-app-default-rtdb.firebaseio.com",
            projectId: "paralegal-web-app",
            storageBucket: "paralegal-web-app.firebasestorage.app",
            messagingSenderId: "966897791344",
            appId: "1:966897791344:web:83ca8aceb0426a4b925fb5",
            measurementId: "G-ZHKTRGZSJK"
        };

        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- DOM Elements ---
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const emailInput = document.getElementById('email');
        const messageEl = document.getElementById('message');
        const resetPasswordBtn = document.getElementById('reset-password-btn');
        const loadingSpinner = document.getElementById('loading-spinner');
        const forgotPasswordCard = document.getElementById('forgot-password-card');

        // --- Preloader Logic ---
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            const loadingBar = document.getElementById('loading-bar');

            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                if (progress <= 100) {
                    loadingBar.style.width = `${progress}%`;
                } else {
                    clearInterval(interval);
                }
            }, 100);

            setTimeout(() => {
                if (preloader) {
                    preloader.classList.add('preloader-hidden');
                    preloader.addEventListener('transitionend', () => {
                        preloader.remove();
                        forgotPasswordCard.style.animation = 'fade-in-up-content 1s ease-out forwards'; // Start card animation
                    });
                }
            }, 1500);
        });

        // --- Function to display messages ---
        function showMessage(element, message, isError = true) {
            element.textContent = message;
            element.classList.remove('hidden', 'text-red-500', 'text-green-500');
            element.classList.add(isError ? 'text-red-500' : 'text-green-500');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 7000); // Message disappears after 7 seconds
        }

        // --- Handle Forgot Password Form Submission ---
        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value.trim();

            if (!email) {
                showMessage(messageEl, "Please enter your email address.", true);
                return;
            }

            // Show loading state
            resetPasswordBtn.disabled = true;
            loadingSpinner.classList.remove('hidden');
            messageEl.classList.add('hidden'); // Hide previous messages

            try {
                await sendPasswordResetEmail(auth, email);
                showMessage(messageEl, "A password reset link has been sent by GreenLeaf National Bank to your email address. Please check your inbox (and spam folder).", false);
                emailInput.value = ''; // Clear email field on success
            } catch (error) {
                console.error("Forgot Password Error:", error);
                let errorMessage = "Failed to send password reset email. Please try again.";
                if (error.code === 'auth/user-not-found') {
                    errorMessage = "No user found with that email address. Please check your email and try again.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "The email address is not valid.";
                }
                showMessage(messageEl, errorMessage, true);
            } finally {
                // Hide loading state
                resetPasswordBtn.disabled = false;
                loadingSpinner.classList.add('hidden');
            }
        });

        // --- Theme Switching (Copied from dashboard for consistency) ---
        const savedTheme = localStorage.getItem('finflowTheme') || 'dark';

        function applyTheme(themeName) {
            document.body.classList.remove('light', 'dark');
            document.body.classList.add(themeName);
            localStorage.setItem('finflowTheme', themeName);
        }

        // Apply theme on page load
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(savedTheme);
        });
    </script>
</body>
</html>
